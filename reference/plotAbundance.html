<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plotting abundance data — plotAbundance • miaViz</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Plotting abundance data — plotAbundance"><meta property="og:description" content="plotAbundance plots the abundance on a selected taxonomic rank.
Since this probably makes sense only for relative abundance data, the
assay used by default is expected to be in the slot &amp;#8216;relabundance&amp;#8217;.
If only &amp;#8216;counts&amp;#8217; is present, the relative abundance is computed."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">miaViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/miaViz.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plotting abundance data</h1>
    
    <div class="hidden name"><code>plotAbundance.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>plotAbundance</code> plots the abundance on a selected taxonomic rank.
Since this probably makes sense only for relative abundance data, the
assay used by default is expected to be in the slot ‘relabundance’.
If only ‘counts’ is present, the relative abundance is computed.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for SummarizedExperiment</span></span>
<span><span class="fu">plotAbundance</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  rank <span class="op">=</span> <span class="fu">taxonomyRanks</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  order_rank_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"abund"</span>, <span class="st">"revabund"</span><span class="op">)</span>,</span>
<span>  order_sample_by <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  decreasing <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  use_relative <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bar"</span>, <span class="st">"point"</span><span class="op">)</span>,</span>
<span>  one_facet <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  scales <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>  assay.type <span class="op">=</span> <span class="va">assay_name</span>,</span>
<span>  assay_name <span class="op">=</span> <span class="st">"counts"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a
<code><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">SummarizedExperiment</a></code>
object.</p></dd>


<dt>...</dt>
<dd><p>additional parameters for plotting. See
<code><a href="mia-plot-args.html">mia-plot-args</a></code> for more details i.e. call <code><a href="mia-plot-args.html">help("mia-plot-args")</a></code></p></dd>


<dt>rank</dt>
<dd><p>a single <code>character</code> value defining the taxonomic rank to
use. Must be a value of <code>taxonomyRanks(x)</code>.</p></dd>


<dt>features</dt>
<dd><p>a single <code>character</code> value defining a column from
<code>colData</code> to be plotted below the abundance plot.
Continuous numeric values will be plotted as point, whereas factors and
character will be plotted as colour-code bar. (default: <code>features =
  NULL</code>)</p></dd>


<dt>order_rank_by</dt>
<dd><p>How to order abundance value: By name (“name”)
for sorting the taxonomic labels alphabetically, by abundance (“abund”) to
sort by abundance values or by a reverse order of abundance values (“revabund”).</p></dd>


<dt>order_sample_by</dt>
<dd><p>A single character value from the chosen rank of abundance
data or from <code>colData</code> to select values to order the abundance
plot by. (default: <code>order_sample_by = NULL</code>)</p></dd>


<dt>decreasing</dt>
<dd><p>TRUE or FALSE: If the <code>order_sample_by</code> is defined and the
values are numeric, should the values used to order in decreasing or
increasing fashion? (default: <code>decreasing = FALSE</code>)</p></dd>


<dt>use_relative</dt>
<dd><p><code>TRUE</code> or <code>FALSE</code>: Should the relative values
be calculated? (default: <code>use_relative = TRUE</code>)</p></dd>


<dt>layout</dt>
<dd><p>Either “bar” or “point”.</p></dd>


<dt>one_facet</dt>
<dd><p>Should the plot be returned in on facet or split into
different facet, one facet per different value detect in <code>rank</code>. If
<code>features</code> or <code>order_sample_by</code> is not <code>NULL</code>, this setting will
be disregarded.</p></dd>


<dt>ncol, scales</dt>
<dd><p>if <code>one_facet = FALSE</code>, <code>ncol</code> defines many
columns should be for plotting the different facets and <code>scales</code> is
used to define the behavior of the scales of each facet. Both values are
passed onto <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></code>.</p></dd>


<dt>assay.type</dt>
<dd><p>a <code>character</code> value defining which assay data to
use. (default: <code>assay.type = "relabundance"</code>)</p></dd>


<dt>assay_name</dt>
<dd><p>a single <code>character</code> value for specifying which
assay to use for calculation.
(Please use <code>assay.type</code> instead. At some point <code>assay_name</code>
will be disabled.)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></code> object or list of two
<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></code> objects, if <code>features</code> are added to
the plot.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Subsetting to rows of interested and ordering of those is expected to be done
outside of this functions, e.g. <code>x[1:2,]</code>. This will plot data of all
features present.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">GlobalPatterns</span>, package<span class="op">=</span><span class="st">"mia"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="va">GlobalPatterns</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plotting abundance using the first taxonomic rank as default</span></span></span>
<span class="r-in"><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type<span class="op">=</span><span class="st">"counts"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-1.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using "Phylum" as rank</span></span></span>
<span class="r-in"><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type<span class="op">=</span><span class="st">"counts"</span>, rank <span class="op">=</span> <span class="st">"Phylum"</span>, add_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-2.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## If rank is set to NULL plotAbundance behaves like plotExpression</span></span></span>
<span class="r-in"><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type<span class="op">=</span><span class="st">"counts"</span>, rank <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>           features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-3.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co">## A feature from colData or taxon from chosen rank can be used for ordering samples.</span></span></span>
<span class="r-in"><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type<span class="op">=</span><span class="st">"counts"</span>, rank <span class="op">=</span> <span class="st">"Phylum"</span>,</span></span>
<span class="r-in"><span>           order_sample_by <span class="op">=</span> <span class="st">"Bacteroidetes"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-4.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Features from colData can be plotted together with abundance plot.</span></span></span>
<span class="r-in"><span><span class="co"># Returned object is a list that includes two plot; other visualizes abundance</span></span></span>
<span class="r-in"><span><span class="co"># other features. </span></span></span>
<span class="r-in"><span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type <span class="op">=</span> <span class="st">"counts"</span>, rank <span class="op">=</span> <span class="st">"Phylum"</span>,</span></span>
<span class="r-in"><span>                   features <span class="op">=</span> <span class="st">"SampleType"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># These two plots can be combined with wrap_plots function from patchwork package</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plot</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-5.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Same plot as above but showing sample IDs as labels for the x axis on the top plot</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">plot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type <span class="op">=</span> <span class="st">"counts"</span>, rank <span class="op">=</span> <span class="st">"Phylum"</span>,</span></span>
<span class="r-in"><span>                           features <span class="op">=</span> <span class="st">"SampleType"</span>, add_legend <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                           add_x_text <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                           <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plot</span>, ncol <span class="op">=</span> <span class="fl">1</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>,<span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-6.png" alt="" width="3000" height="2100"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Compositional barplot with top 5 taxa and samples sorted by "Bacteroidetes"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Getting top taxa on a Phylum level</span></span></span>
<span class="r-in"><span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu">transformAssay</span><span class="op">(</span><span class="va">se</span>, method<span class="op">=</span><span class="st">"relabundance"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">se_phylum</span> <span class="op">&lt;-</span> <span class="fu">agglomerateByRank</span><span class="op">(</span><span class="va">se</span>, rank <span class="op">=</span><span class="st">"Phylum"</span>, onRankOnly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">top_taxa</span> <span class="op">&lt;-</span> <span class="fu">getTopFeatures</span><span class="op">(</span><span class="va">se_phylum</span>,top <span class="op">=</span> <span class="fl">5</span>, assay.type <span class="op">=</span> <span class="st">"relabundance"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Renaming the "Phylum" rank to keep only top taxa and the rest to "Other"</span></span></span>
<span class="r-in"><span><span class="va">phylum_renamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">rowData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">Phylum</span>,</span></span>
<span class="r-in"><span>                       <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top_taxa</span><span class="op">)</span> <span class="op">{</span><span class="va">x</span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span><span class="st">"Other"</span><span class="op">}</span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">rowData</span><span class="op">(</span><span class="va">se</span><span class="op">)</span><span class="op">$</span><span class="va">Phylum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">phylum_renamed</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compositional barplot</span></span></span>
<span class="r-in"><span><span class="fu">plotAbundance</span><span class="op">(</span><span class="va">se</span>, assay.type<span class="op">=</span><span class="st">"relabundance"</span>, rank <span class="op">=</span> <span class="st">"Phylum"</span>,</span></span>
<span class="r-in"><span>           order_rank_by<span class="op">=</span><span class="st">"abund"</span>, order_sample_by <span class="op">=</span> <span class="st">"Bacteroidetes"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plotAbundance-7.png" alt="" width="3000" height="2100"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Tuomas Borman, Felix G.M. Ernst, Leo Lahti.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

      </footer></div>

  


  

  </body></html>

